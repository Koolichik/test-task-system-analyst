Тестовое задание — системный аналитик

Проект: Интернет-магазин «Петрушка Зеленая»

Задание 1. Анализ требований (Функционал «Корзина»)
1. Обнаруженные противоречия и недочёты
Пункт ТЗ	  Проблема				                Пояснение
2 и 9		    Логическое противоречие  	    	П.2 запрещает уменьшать количество меньше 1, п.9 разрешает 0 и удаление
7 и 13		  Противоречие в логике цены    	В п.7 цена фиксируется, в п.13 — должна	обновляться
5		        Избыточное требование		        Фраза «товары могут быть разные» не несёт полезной информации
6		        Недостаточная детализация	      Не указано, какой именно лимит превышен и как должна вести себя система
8		        Неполнота отображения цены    	Нет правил округления, валюты, учёта скидок
10–11		    Неполные требования к рекламе	  Нет точных временных интервалов, таймзоны, логики показа вне указанных периодов
            Нарушена нумерация		          Отсутствует пункт 12

2. Исправленная версия требований:
Функционал «Корзина» (версия без противоречий)
Корзина содержит позиции товаров (SKU/offer).
Количество одного товара в корзине: от 1 до 10 шт.
В корзине может находиться не более 5 различных позиций.
Суммарное количество всех товаров в корзине — не более 20 шт.
При добавлении или изменении количества выполняется проверка ограничений (п.2–4).
При нарушении лимитов операция не выполняется, выводится сообщение:
«Лимит корзины превышен: максимум 10 шт. одного товара, 5 разных товаров и 20 шт. всего.»

Товар удаляется из корзины:
кнопкой «Удалить»,
либо при установке количества 0 (если это предусмотрено интерфейсом).

В корзине отображаются: название товара, количество, цена за единицу, сумма по позиции, итоговая сумма.
Цена в корзине синхронизируется с каталогом. При изменении цены пользователю показывается уведомление «Цена на товар изменилась».
В корзине может отображаться рекламный блок «Рекомендуем».
Рекламный блок показывается по будням с 08:00–11:59 и 18:00–21:59 по таймзоне пользователя.

3. Вопросы к заказчику
Что считать «различными товарами»: SKU, вариация, размер, цвет?
Как учитывать складские остатки?
При превышении лимита добавлять максимально возможное количество или полностью отклонять операцию?
Нужно ли сохранять историю изменения цены?
Есть ли скидки, промокоды, персональные цены?
Какие правила округления и валюта?
Откуда берётся реклама и сколько товаров в блоке?
Что показывать в выходные дни вместо рекламы?

Задание 2. Проектирование REST API
Пример запроса
GET /api/v1/partners/stores?city_id=123&limit=20&offset=0
Authorization: Bearer <token>
Accept: application/json

Пример ответа
{
  "city": {
    "id": 123,
    "name": "Москва"
  },
  "items": [
    {
      "id": "p_101",
      "name": "Лавка Фермера",
      "subtitle": "Скидка 10% по промокоду",
      "logo_url": "https://cdn.petrushka.ru/partners/p_101/logo.png",
      "deeplink_url": "https://partner.example.com/open?ref=petrushka&p=p_101",
      "badge": {
        "text": "Акция",
        "type": "promo"
      }
    }
  ],
  "paging": {
    "limit": 20,
    "offset": 0,
    "total": 57
  }
}


При нажатии на карточку партнёра используется поле deeplink_url для перехода на внешний ресурс.

Задание 3. Архитектура PUSH-уведомлений
Компоненты системы
Мобильное приложение (iOS/Android)
API Gateway / BFF
Notification Service
Kafka / RabbitMQ (Event Bus)
Сервисы домена (Cart, Order, Marketing)
База токенов устройств
База шаблонов уведомлений
FCM (Android) / APNs (iOS)
Поток регистрации устройства
Приложение получает push-токен от FCM/APNs
Отправляет токен на backend
Notification Service сохраняет user_id + device_id + token + platform
Триггерные PUSH (например, забытая корзина)
Cart Service публикует событие cart.abandoned в брокер сообщений
Notification Service получает событие
Проверяет правила отправки (время, частота, сегмент)
Формирует сообщение по шаблону
Отправляет в FCM/APNs
Сохраняет статус доставки
Массовые маркетинговые PUSH
Marketing Service создаёт кампанию
Notification Service получает список пользователей
Рассылка отправляется батчами
Результаты логируются

Важные нефункциональные аспекты:
дедупликация уведомлений
ограничение частоты отправки
повторные попытки отправки при ошибках
логирование и мониторинг доставки

Итог: предложенная архитектура масштабируема, соответствует микросервисному подходу и поддерживает как триггерные, так и массовые уведомления.
